<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>RxAVQuery.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a> </h2><h3>Classes</h3><ul><li><a href="RxAVACL.html">RxAVACL</a><ul class='methods'><li data-type='method'><a href="RxAVACL.html#.RxAVACL">RxAVACL</a></li><li data-type='method'><a href="RxAVACL.html#equals">equals</a></li><li data-type='method'><a href="RxAVACL.html#findWriteAccess">findWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getPublicReadAccess">getPublicReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getPublicWriteAccess">getPublicWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getReadAccess">getReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getRoleReadAccess">getRoleReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getRoleWriteAccess">getRoleWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getWriteAccess">getWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setPublicReadAccess">setPublicReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setPublicWriteAccess">setPublicWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setReadAccess">setReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setRoleReadAccess">setRoleReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setRoleWriteAccess">setRoleWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setWriteAccess">setWriteAccess</a></li></ul></li><li><a href="RxAVAnalytics.html">RxAVAnalytics</a><ul class='methods'><li data-type='method'><a href="RxAVAnalytics.html#.get">get</a></li><li data-type='method'><a href="RxAVAnalytics.html#.init">init</a></li><li data-type='method'><a href="RxAVAnalytics.html#.report">report</a></li><li data-type='method'><a href="RxAVAnalytics.html#beginEevent">beginEevent</a></li><li data-type='method'><a href="RxAVAnalytics.html#beginPage">beginPage</a></li><li data-type='method'><a href="RxAVAnalytics.html#closeSesstion">closeSesstion</a></li><li data-type='method'><a href="RxAVAnalytics.html#endEvent">endEvent</a></li><li data-type='method'><a href="RxAVAnalytics.html#endPage">endPage</a></li><li data-type='method'><a href="RxAVAnalytics.html#save">save</a></li><li data-type='method'><a href="RxAVAnalytics.html#send">send</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackAppOpened">trackAppOpened</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackAppOpenedWithPush">trackAppOpenedWithPush</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackEvent">trackEvent</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackPage">trackPage</a></li></ul></li><li><a href="RxAVClient.html">RxAVClient</a><ul class='methods'><li data-type='method'><a href="RxAVClient.html#.init">init</a></li></ul></li><li><a href="RxAVInstallation.html">RxAVInstallation</a><ul class='methods'><li data-type='method'><a href="RxAVInstallation.html#.current">current</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.set">set</a></li><li data-type='method'><a href="RxAVInstallation.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVInstallation.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVInstallation.html#remove">remove</a></li><li data-type='method'><a href="RxAVInstallation.html#save">save</a></li></ul></li><li><a href="RxAVObject.html">RxAVObject</a><ul class='methods'><li data-type='method'><a href="RxAVObject.html#.createSubclass">createSubclass</a></li><li data-type='method'><a href="RxAVObject.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="RxAVObject.html#.get">get</a></li><li data-type='method'><a href="RxAVObject.html#.get">get</a></li><li data-type='method'><a href="RxAVObject.html#.saveAll">saveAll</a></li><li data-type='method'><a href="RxAVObject.html#.set">set</a></li><li data-type='method'><a href="RxAVObject.html#.set">set</a></li><li data-type='method'><a href="RxAVObject.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVObject.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVObject.html#remove">remove</a></li><li data-type='method'><a href="RxAVObject.html#save">save</a></li></ul></li><li><a href="RxAVPush.html">RxAVPush</a><ul class='methods'><li data-type='method'><a href="RxAVPush.html#.sendContent">sendContent</a></li><li data-type='method'><a href="RxAVPush.html#.sendTo">sendTo</a></li><li data-type='method'><a href="RxAVPush.html#send">send</a></li></ul></li><li><a href="RxAVQuery.html">RxAVQuery</a><ul class='methods'><li data-type='method'><a href="RxAVQuery.html#.or">or</a></li><li data-type='method'><a href="RxAVQuery.html#find">find</a></li></ul></li><li><a href="RxAVRole.html">RxAVRole</a><ul class='methods'><li data-type='method'><a href="RxAVRole.html#.createWithName">createWithName</a></li><li data-type='method'><a href="RxAVRole.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="RxAVRole.html#.RxAVRole">RxAVRole</a></li><li data-type='method'><a href="RxAVRole.html#deny">deny</a></li><li data-type='method'><a href="RxAVRole.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVRole.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVRole.html#grant">grant</a></li><li data-type='method'><a href="RxAVRole.html#remove">remove</a></li><li data-type='method'><a href="RxAVRole.html#save">save</a></li></ul></li><li><a href="RxAVUser.html">RxAVUser</a><ul class='methods'><li data-type='method'><a href="RxAVUser.html#.current">current</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.logIn">logIn</a></li><li data-type='method'><a href="RxAVUser.html#.logInByMobilephone">logInByMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#.logInWithMobilephone">logInWithMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#.sendLogInShortcode">sendLogInShortcode</a></li><li data-type='method'><a href="RxAVUser.html#.sendSignUpShortcode">sendSignUpShortcode</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.signUpByMobilephone">signUpByMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#activate">activate</a></li><li data-type='method'><a href="RxAVUser.html#create">create</a></li><li data-type='method'><a href="RxAVUser.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVUser.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVUser.html#fetchRoles">fetchRoles</a></li><li data-type='method'><a href="RxAVUser.html#inactive">inactive</a></li><li data-type='method'><a href="RxAVUser.html#isAuthenticated">isAuthenticated</a></li><li data-type='method'><a href="RxAVUser.html#logOut">logOut</a></li><li data-type='method'><a href="RxAVUser.html#remove">remove</a></li><li data-type='method'><a href="RxAVUser.html#save">save</a></li><li data-type='method'><a href="RxAVUser.html#signUp">signUp</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">RxAVQuery.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var RxLeanCloud_1 = require('../RxLeanCloud');
var SDKPlugins_1 = require('../internal/SDKPlugins');
/**
 * 针对 RxAVObject 的查询构建类
 *
 * @export
 * @class RxAVQuery
 */
var RxAVQuery = (function () {
    function RxAVQuery(objectClass) {
        if (typeof objectClass === 'string') {
            this.className = objectClass;
        }
        else if (objectClass instanceof RxLeanCloud_1.RxAVObject) {
            this.className = objectClass.className;
        }
        else {
            throw new Error('A RxAVQuery must be constructed with a RxAVObject or class name.');
        }
        this._where = {};
        this._include = [];
        this._limit = -1; // negative limit is not sent in the server request
        this._skip = 0;
        this._extraOptions = {};
    }
    Object.defineProperty(RxAVQuery, "_encoder", {
        get: function () {
            return SDKPlugins_1.SDKPlugins.instance.Encoder;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxAVQuery, "_queryController", {
        get: function () {
            return SDKPlugins_1.SDKPlugins.instance.QueryControllerInstance;
        },
        enumerable: true,
        configurable: true
    });
    RxAVQuery.prototype.config = function (filter, limit, skip, include, select) {
        return new RxAVQuery(this.className);
    };
    RxAVQuery.prototype.equalTo = function (key, value) {
        this._where[key] = this._encode(value, false, true);
        return this;
    };
    RxAVQuery.prototype.notEqualTo = function (key, value) {
        return this._addCondition(key, '$ne', value);
    };
    RxAVQuery.prototype.lessThan = function (key, value) {
        return this._addCondition(key, '$lt', value);
    };
    RxAVQuery.prototype.lessThanOrEqualTo = function (key, value) {
        return this._addCondition(key, '$lte', value);
    };
    RxAVQuery.prototype.greaterThan = function (key, value) {
        return this._addCondition(key, '$gt', value);
    };
    RxAVQuery.prototype.greaterThanOrEqualTo = function (key, value) {
        return this._addCondition(key, '$gte', value);
    };
    RxAVQuery.prototype.containedIn = function (key, value) {
        return this._addCondition(key, '$in', value);
    };
    RxAVQuery.prototype.notContainedIn = function (key, value) {
        return this._addCondition(key, '$nin', value);
    };
    RxAVQuery.prototype.containsAll = function (key, values) {
        return this._addCondition(key, '$all', values);
    };
    RxAVQuery.prototype.exists = function (key) {
        return this._addCondition(key, '$exists', true);
    };
    RxAVQuery.prototype.doesNotExist = function (key) {
        return this._addCondition(key, '$exists', false);
    };
    RxAVQuery.prototype.contains = function (key, value) {
        if (typeof value !== 'string') {
            throw new Error('The value being searched for must be a string.');
        }
        return this._addCondition(key, '$regex', this.quote(value));
    };
    RxAVQuery.prototype.startsWith = function (key, value) {
        if (typeof value !== 'string') {
            throw new Error('The value being searched for must be a string.');
        }
        return this._addCondition(key, '$regex', '^' + this.quote(value));
    };
    RxAVQuery.prototype.endsWith = function (key, value) {
        if (typeof value !== 'string') {
            throw new Error('The value being searched for must be a string.');
        }
        return this._addCondition(key, '$regex', this.quote(value) + '$');
    };
    RxAVQuery.prototype.quote = function (s) {
        return '\\Q' + s.replace('\\E', '\\E\\\\E\\Q') + '\\E';
    };
    RxAVQuery.prototype.relatedTo = function (parent, key) {
        this._addCondition('$relatedTo', 'object', {
            __type: 'Pointer',
            className: parent.className,
            objectId: parent.objectId
        });
        return this._addCondition('$relatedTo', 'key', key);
    };
    RxAVQuery.prototype.ascending = function () {
        var keys = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            keys[_i - 0] = arguments[_i];
        }
        this._order = [];
        return this.addAscending.apply(this, keys);
    };
    RxAVQuery.prototype.addAscending = function () {
        var _this = this;
        var keys = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            keys[_i - 0] = arguments[_i];
        }
        if (!this._order) {
            this._order = [];
        }
        keys.forEach(function (key) {
            if (Array.isArray(key)) {
                key = key.join();
            }
            _this._order = _this._order.concat(key.replace(/\s/g, '').split(','));
        });
        return this;
    };
    RxAVQuery.prototype.descending = function () {
        var keys = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            keys[_i - 0] = arguments[_i];
        }
        this._order = [];
        return this.addDescending.apply(this, keys);
    };
    RxAVQuery.prototype.addDescending = function () {
        var _this = this;
        var keys = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            keys[_i - 0] = arguments[_i];
        }
        if (!this._order) {
            this._order = [];
        }
        keys.forEach(function (key) {
            if (Array.isArray(key)) {
                key = key.join();
            }
            _this._order = _this._order.concat(key.replace(/\s/g, '').split(',').map(function (k) {
                return '-' + k;
            }));
        });
        return this;
    };
    RxAVQuery.prototype.skip = function (n) {
        if (typeof n !== 'number' || n &lt; 0) {
            throw new Error('You can only skip by a positive number');
        }
        this._skip = n;
        return this;
    };
    RxAVQuery.prototype.limit = function (n) {
        if (typeof n !== 'number') {
            throw new Error('You can only set the limit to a numeric value');
        }
        this._limit = n;
        return this;
    };
    RxAVQuery.prototype.include = function () {
        var _this = this;
        var keys = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            keys[_i - 0] = arguments[_i];
        }
        keys.forEach(function (key) {
            if (Array.isArray(key)) {
                _this._include = _this._include.concat(key);
            }
            else {
                _this._include.push(key);
            }
        });
        return this;
    };
    RxAVQuery.prototype.select = function () {
        var _this = this;
        var keys = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            keys[_i - 0] = arguments[_i];
        }
        if (!this._select) {
            this._select = [];
        }
        keys.forEach(function (key) {
            if (Array.isArray(key)) {
                _this._select = _this._select.concat(key);
            }
            else {
                _this._select.push(key);
            }
        });
        return this;
    };
    /**
     * 执行查询
     *
     * @returns {Observable&lt;Array&lt;RxAVObject>>}
     *
     * @memberOf RxAVQuery
     */
    RxAVQuery.prototype.find = function () {
        var _this = this;
        return RxAVQuery._queryController.find(this, RxLeanCloud_1.RxAVUser.currentSessionToken).map(function (serverStates) {
            var resultList = serverStates.map(function (serverState, i, a) {
                var rxObject = new RxLeanCloud_1.RxAVObject(_this.className);
                rxObject.handleFetchResult(serverState);
                return rxObject;
            });
            if (resultList == undefined || resultList == null) {
                resultList = [];
            }
            return resultList;
        });
    };
    /**
     *
     *
     * @static
     * @param {...Array&lt;RxAVQuery>} queries
     * @returns {RxAVQuery}
     *
     * @memberOf RxAVQuery
     */
    RxAVQuery.or = function () {
        var queries = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            queries[_i - 0] = arguments[_i];
        }
        var className = null;
        queries.forEach(function (q) {
            if (!className) {
                className = q.className;
            }
            if (className !== q.className) {
                throw new Error('All queries must be for the same class.');
            }
        });
        var query = new RxAVQuery(className);
        query._orQuery(queries);
        return query;
    };
    RxAVQuery.prototype._orQuery = function (queries) {
        var queryJSON = queries.map(function (q) {
            return q._where;
        });
        this._where.$or = queryJSON;
        return this;
    };
    RxAVQuery.prototype._addCondition = function (key, condition, value) {
        if (!this._where[key] || typeof this._where[key] === 'string') {
            this._where[key] = {};
        }
        this._where[key][condition] = this._encode(value, false, true);
        return this;
    };
    RxAVQuery.prototype._encode = function (value, disallowObjects, forcePointers) {
        return RxAVQuery._encoder.encodeItem(value);
    };
    RxAVQuery.prototype.buildParameters = function (includeClassName) {
        if (includeClassName === void 0) { includeClassName = false; }
        var result = {};
        if (Object.keys(this._where).length > 0) {
            result['where'] = JSON.stringify(this._where);
        }
        if (this._order) {
            result["order"] = this._order.join(",");
        }
        if (this._limit > 0) {
            result["limit"] = this._limit;
        }
        if (this._skip > 0) {
            result["skip"] = this._skip;
        }
        if (this._include.length) {
            result['include'] = this._include.join(',');
        }
        if (this._select) {
            result['keys'] = this._select.join(',');
        }
        return result;
    };
    return RxAVQuery;
}());
exports.RxAVQuery = RxAVQuery;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Mar 01 2017 16:21:37 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
