<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>RxAVUser.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">leancloud-typescript-rx-sdk</a> <span class='package-version'>v0.0.9-alpha.1</span></h2><h3>Classes</h3><ul><li><a href="RxAVACL.html">RxAVACL</a><ul class='methods'><li data-type='method'><a href="RxAVACL.html#.RxAVACL">RxAVACL</a></li><li data-type='method'><a href="RxAVACL.html#.RxAVACL">RxAVACL</a></li><li data-type='method'><a href="RxAVACL.html#equals">equals</a></li><li data-type='method'><a href="RxAVACL.html#equals">equals</a></li><li data-type='method'><a href="RxAVACL.html#findWriteAccess">findWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#findWriteAccess">findWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getPublicReadAccess">getPublicReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getPublicReadAccess">getPublicReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getPublicWriteAccess">getPublicWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getPublicWriteAccess">getPublicWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getReadAccess">getReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getReadAccess">getReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getRoleReadAccess">getRoleReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getRoleReadAccess">getRoleReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#getRoleWriteAccess">getRoleWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getRoleWriteAccess">getRoleWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getWriteAccess">getWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#getWriteAccess">getWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setPublicReadAccess">setPublicReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setPublicReadAccess">setPublicReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setPublicWriteAccess">setPublicWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setPublicWriteAccess">setPublicWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setReadAccess">setReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setReadAccess">setReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setRoleReadAccess">setRoleReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setRoleReadAccess">setRoleReadAccess</a></li><li data-type='method'><a href="RxAVACL.html#setRoleWriteAccess">setRoleWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setRoleWriteAccess">setRoleWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setWriteAccess">setWriteAccess</a></li><li data-type='method'><a href="RxAVACL.html#setWriteAccess">setWriteAccess</a></li></ul></li><li><a href="RxAVAnalytics.html">RxAVAnalytics</a><ul class='methods'><li data-type='method'><a href="RxAVAnalytics.html#.get">get</a></li><li data-type='method'><a href="RxAVAnalytics.html#.get">get</a></li><li data-type='method'><a href="RxAVAnalytics.html#.init">init</a></li><li data-type='method'><a href="RxAVAnalytics.html#.init">init</a></li><li data-type='method'><a href="RxAVAnalytics.html#.report">report</a></li><li data-type='method'><a href="RxAVAnalytics.html#.report">report</a></li><li data-type='method'><a href="RxAVAnalytics.html#beginEevent">beginEevent</a></li><li data-type='method'><a href="RxAVAnalytics.html#beginEevent">beginEevent</a></li><li data-type='method'><a href="RxAVAnalytics.html#beginPage">beginPage</a></li><li data-type='method'><a href="RxAVAnalytics.html#beginPage">beginPage</a></li><li data-type='method'><a href="RxAVAnalytics.html#closeSesstion">closeSesstion</a></li><li data-type='method'><a href="RxAVAnalytics.html#closeSesstion">closeSesstion</a></li><li data-type='method'><a href="RxAVAnalytics.html#endEvent">endEvent</a></li><li data-type='method'><a href="RxAVAnalytics.html#endEvent">endEvent</a></li><li data-type='method'><a href="RxAVAnalytics.html#endPage">endPage</a></li><li data-type='method'><a href="RxAVAnalytics.html#endPage">endPage</a></li><li data-type='method'><a href="RxAVAnalytics.html#save">save</a></li><li data-type='method'><a href="RxAVAnalytics.html#save">save</a></li><li data-type='method'><a href="RxAVAnalytics.html#send">send</a></li><li data-type='method'><a href="RxAVAnalytics.html#send">send</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackAppOpened">trackAppOpened</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackAppOpened">trackAppOpened</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackAppOpenedWithPush">trackAppOpenedWithPush</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackAppOpenedWithPush">trackAppOpenedWithPush</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackEvent">trackEvent</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackEvent">trackEvent</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackPage">trackPage</a></li><li data-type='method'><a href="RxAVAnalytics.html#trackPage">trackPage</a></li></ul></li><li><a href="RxAVClient.html">RxAVClient</a><ul class='methods'><li data-type='method'><a href="RxAVClient.html#.init">init</a></li><li data-type='method'><a href="RxAVClient.html#.init">init</a></li></ul></li><li><a href="RxAVInstallation.html">RxAVInstallation</a><ul class='methods'><li data-type='method'><a href="RxAVInstallation.html#.current">current</a></li><li data-type='method'><a href="RxAVInstallation.html#.current">current</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.get">get</a></li><li data-type='method'><a href="RxAVInstallation.html#.set">set</a></li><li data-type='method'><a href="RxAVInstallation.html#.set">set</a></li><li data-type='method'><a href="RxAVInstallation.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVInstallation.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVInstallation.html#remove">remove</a></li><li data-type='method'><a href="RxAVInstallation.html#save">save</a></li><li data-type='method'><a href="RxAVInstallation.html#save">save</a></li></ul></li><li><a href="RxAVObject.html">RxAVObject</a><ul class='methods'><li data-type='method'><a href="RxAVObject.html#.createSubclass">createSubclass</a></li><li data-type='method'><a href="RxAVObject.html#.createSubclass">createSubclass</a></li><li data-type='method'><a href="RxAVObject.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="RxAVObject.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="RxAVObject.html#.get">get</a></li><li data-type='method'><a href="RxAVObject.html#.get">get</a></li><li data-type='method'><a href="RxAVObject.html#.get">get</a></li><li data-type='method'><a href="RxAVObject.html#.get">get</a></li><li data-type='method'><a href="RxAVObject.html#.saveAll">saveAll</a></li><li data-type='method'><a href="RxAVObject.html#.saveAll">saveAll</a></li><li data-type='method'><a href="RxAVObject.html#.set">set</a></li><li data-type='method'><a href="RxAVObject.html#.set">set</a></li><li data-type='method'><a href="RxAVObject.html#.set">set</a></li><li data-type='method'><a href="RxAVObject.html#.set">set</a></li><li data-type='method'><a href="RxAVObject.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVObject.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVObject.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVObject.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVObject.html#remove">remove</a></li><li data-type='method'><a href="RxAVObject.html#remove">remove</a></li><li data-type='method'><a href="RxAVObject.html#save">save</a></li><li data-type='method'><a href="RxAVObject.html#save">save</a></li></ul></li><li><a href="RxAVPush.html">RxAVPush</a><ul class='methods'><li data-type='method'><a href="RxAVPush.html#.sendContent">sendContent</a></li><li data-type='method'><a href="RxAVPush.html#.sendContent">sendContent</a></li><li data-type='method'><a href="RxAVPush.html#.sendTo">sendTo</a></li><li data-type='method'><a href="RxAVPush.html#.sendTo">sendTo</a></li><li data-type='method'><a href="RxAVPush.html#send">send</a></li><li data-type='method'><a href="RxAVPush.html#send">send</a></li></ul></li><li><a href="RxAVQuery.html">RxAVQuery</a><ul class='methods'><li data-type='method'><a href="RxAVQuery.html#.or">or</a></li><li data-type='method'><a href="RxAVQuery.html#.or">or</a></li><li data-type='method'><a href="RxAVQuery.html#find">find</a></li><li data-type='method'><a href="RxAVQuery.html#find">find</a></li></ul></li><li><a href="RxAVRole.html">RxAVRole</a><ul class='methods'><li data-type='method'><a href="RxAVRole.html#.createWithName">createWithName</a></li><li data-type='method'><a href="RxAVRole.html#.createWithName">createWithName</a></li><li data-type='method'><a href="RxAVRole.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="RxAVRole.html#.createWithoutData">createWithoutData</a></li><li data-type='method'><a href="RxAVRole.html#.RxAVRole">RxAVRole</a></li><li data-type='method'><a href="RxAVRole.html#.RxAVRole">RxAVRole</a></li><li data-type='method'><a href="RxAVRole.html#deny">deny</a></li><li data-type='method'><a href="RxAVRole.html#deny">deny</a></li><li data-type='method'><a href="RxAVRole.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVRole.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVRole.html#grant">grant</a></li><li data-type='method'><a href="RxAVRole.html#grant">grant</a></li><li data-type='method'><a href="RxAVRole.html#remove">remove</a></li><li data-type='method'><a href="RxAVRole.html#save">save</a></li></ul></li><li><a href="RxAVUser.html">RxAVUser</a><ul class='methods'><li data-type='method'><a href="RxAVUser.html#.current">current</a></li><li data-type='method'><a href="RxAVUser.html#.current">current</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.get">get</a></li><li data-type='method'><a href="RxAVUser.html#.logIn">logIn</a></li><li data-type='method'><a href="RxAVUser.html#.logIn">logIn</a></li><li data-type='method'><a href="RxAVUser.html#.logInByMobilephone">logInByMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#.logInByMobilephone">logInByMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#.logInWithMobilephone">logInWithMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#.logInWithMobilephone">logInWithMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#.sendLogInShortcode">sendLogInShortcode</a></li><li data-type='method'><a href="RxAVUser.html#.sendLogInShortcode">sendLogInShortcode</a></li><li data-type='method'><a href="RxAVUser.html#.sendSignUpShortcode">sendSignUpShortcode</a></li><li data-type='method'><a href="RxAVUser.html#.sendSignUpShortcode">sendSignUpShortcode</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.set">set</a></li><li data-type='method'><a href="RxAVUser.html#.signUpByMobilephone">signUpByMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#.signUpByMobilephone">signUpByMobilephone</a></li><li data-type='method'><a href="RxAVUser.html#activate">activate</a></li><li data-type='method'><a href="RxAVUser.html#activate">activate</a></li><li data-type='method'><a href="RxAVUser.html#create">create</a></li><li data-type='method'><a href="RxAVUser.html#create">create</a></li><li data-type='method'><a href="RxAVUser.html#fetch">fetch</a></li><li data-type='method'><a href="RxAVUser.html#fetchRelation">fetchRelation</a></li><li data-type='method'><a href="RxAVUser.html#fetchRoles">fetchRoles</a></li><li data-type='method'><a href="RxAVUser.html#fetchRoles">fetchRoles</a></li><li data-type='method'><a href="RxAVUser.html#inactive">inactive</a></li><li data-type='method'><a href="RxAVUser.html#inactive">inactive</a></li><li data-type='method'><a href="RxAVUser.html#isAuthenticated">isAuthenticated</a></li><li data-type='method'><a href="RxAVUser.html#isAuthenticated">isAuthenticated</a></li><li data-type='method'><a href="RxAVUser.html#logOut">logOut</a></li><li data-type='method'><a href="RxAVUser.html#logOut">logOut</a></li><li data-type='method'><a href="RxAVUser.html#remove">remove</a></li><li data-type='method'><a href="RxAVUser.html#save">save</a></li><li data-type='method'><a href="RxAVUser.html#signUp">signUp</a></li><li data-type='method'><a href="RxAVUser.html#signUp">signUp</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">RxAVUser.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var __extends = (this &amp;&amp; this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var SDKPlugins_1 = require('../internal/SDKPlugins');
var RxLeanCloud_1 = require('../RxLeanCloud');
var rxjs_1 = require('rxjs');
/**
 * 用户
 *
 * @export
 * @class RxAVUser 一个用户对应的是 _User 的一个对象，它的查询权限是关闭的，默认是不可以通过 RxAVQuery 查询用户的
 * @extends {RxAVObject}
 */
var RxAVUser = (function (_super) {
    __extends(RxAVUser, _super);
    function RxAVUser() {
        _super.call(this, '_User');
    }
    Object.defineProperty(RxAVUser, "currentSessionToken", {
        get: function () {
            if (RxAVUser._currentUser) {
                return RxAVUser._currentUser.sesstionToken;
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    RxAVUser.saveCurrentUser = function (user) {
        RxAVUser._currentUser = user;
        return RxLeanCloud_1.RxAVObject.saveToLocalStorage(user, RxAVUser.currenUserCacheKey);
    };
    Object.defineProperty(RxAVUser, "currentUser", {
        get: function () {
            return RxAVUser._currentUser;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取本地缓存文件里面是否存在已经登录过的用户
     *
     * @readonly
     * @static
     * @type {Observable&lt;RxAVUser>}
     * @memberOf RxAVUser
     */
    RxAVUser.current = function () {
        return SDKPlugins_1.SDKPlugins.instance.LocalStorageControllerInstance.get(RxAVUser.currenUserCacheKey).map(function (userCache) {
            if (userCache) {
                var userState = SDKPlugins_1.SDKPlugins.instance.ObjectDecoder.decode(userCache, SDKPlugins_1.SDKPlugins.instance.Decoder);
                userState = userState.mutatedClone(function (s) { });
                var user = RxAVUser.createWithoutData();
                user.handlerLogIn(userState);
                RxAVUser._currentUser = user;
            }
            return RxAVUser._currentUser;
        });
    };
    Object.defineProperty(RxAVUser, "UserController", {
        get: function () {
            return SDKPlugins_1.SDKPlugins.instance.UserControllerInstance;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxAVUser.prototype, "username", {
        /**
         * 获取用户名
         *
         *
         * @memberOf RxAVUser
         */
        get: function () {
            this._username = this.getProperty('username');
            return this._username;
        },
        /**
         * 新用户设置用户名，已注册用户调用这个接口会抛出异常
         *
         *
         * @memberOf RxAVUser
         */
        set: function (username) {
            if (this.sesstionToken == null) {
                this._username = username;
                this.set('username', this._username);
            }
            else {
                throw new Error('can not reset username.');
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxAVUser.prototype, "mobilephone", {
        /**
         * 手机号
         *
         * @readonly
         *
         * @memberOf RxAVUser
         */
        get: function () {
            this._mobilephone = this.getProperty('mobilePhoneNumber');
            return this._mobilephone;
        },
        /**
         * 设置手机号
         *
         *
         * @memberOf RxAVUser
         */
        set: function (mobile) {
            if (this.sesstionToken == null) {
                this._mobilephone = mobile;
                this.set('mobilePhoneNumber', this._mobilephone);
            }
            else {
                throw new Error('can not reset mobilephone.');
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxAVUser.prototype, "password", {
        /**
         * 只有新用户可以设置密码，已注册用户调用这个接口会抛出异常
         *
         *
         * @memberOf RxAVUser
         */
        set: function (password) {
            if (this.sesstionToken == null)
                this.set('password', password);
            else {
                throw new Error('can not set password for a exist user, if you want to reset password, please call requestResetPassword.');
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxAVUser.prototype, "sesstionToken", {
        /**
         * 用户的鉴权信息
         *
         * @readonly
         *
         * @memberOf RxAVUser
         */
        get: function () {
            return this.getProperty('sessionToken');
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 判断当前用户的鉴权信息是否有效
     *
     * @returns {Observable&lt;boolean>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.prototype.isAuthenticated = function () {
        try {
            return !!this.sesstionToken &amp;&amp; RxLeanCloud_1.RxAVClient.request('/users/me', 'GET', null, this.sesstionToken).map(function (body) {
                return true;
            });
        }
        catch (error) {
            return rxjs_1.Observable.from([error.error.code == 211]);
        }
    };
    // public setPrimaryRole(role: RxAVRole) {
    //     this.set('primaryRole', role);
    //     if (role.isDirty)
    //         return role.save().flatMap&lt;boolean>(s1 => {
    //             return role.grant(this);
    //         }).flatMap&lt;boolean>(s2 => {
    //             return this.save();
    //         });
    //     else return role.grant(this).flatMap&lt;boolean>(s3 => {
    //         return this.save();
    //     });
    // }
    // /**
    //  *  获取当前用户的主要角色
    //  * 
    //  * 
    //  * @memberOf RxAVUser
    //  */
    // get primaryRole() {
    //     return this.get('primaryRole');
    // }
    /**
     * 将一个 RxAVInstallation 对象绑定到 RxAVUser
     *
     * @param {RxAVInstallation} installation
     * @param {boolean} unique
     * @returns {Observable&lt;boolean>} 是否成功地绑定了当前设备和 User 的关系
     *
     * @memberOf RxAVUser
     */
    RxAVUser.prototype.activate = function (installation, unique) {
        var _this = this;
        if (!installation || installation == null || !installation.objectId || installation.objectId == null) {
            throw new Error('installation can not be a unsaved object.');
        }
        var ch;
        if (unique) {
            this.remove(RxAVUser.installationKey);
            ch = this.save();
        }
        else {
            ch = rxjs_1.Observable.from([true]);
        }
        var opBody = this.buildRelation('add', [installation]);
        this.set(RxAVUser.installationKey, opBody);
        return ch.flatMap(function (s1) {
            return _this.save();
        });
    };
    /**
     * 取消对当前设备的绑定
     *
     * @param {RxAVInstallation} installation
     * @returns {Observable&lt;boolean>} 是否成功的解绑
     *
     * @memberOf RxAVUser
     */
    RxAVUser.prototype.inactive = function (installation) {
        var opBody = this.buildRelation('remove', [installation]);
        this.set(RxAVUser.installationKey, opBody);
        return this.save();
    };
    /**
     * 从服务端获取当前用户所拥有的角色
     *
     * @returns {Observable&lt;Array&lt;RxAVRole>>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.prototype.fetchRoles = function () {
        var _this = this;
        var query = new RxLeanCloud_1.RxAVQuery('_Role');
        query.equalTo('users', this);
        return query.find().map(function (roles) {
            var fetched = roles.map(function (currentItem) {
                var role = RxLeanCloud_1.RxAVRole.createWithName(currentItem.get('name'), currentItem.objectId);
                return role;
            });
            _this.roles = fetched;
            return fetched;
        });
    };
    /**
     * 使用当前用户的信息注册到 LeanCloud _User 表中
     *
     * @returns {Observable&lt;void>}
     * 返回一个可订阅的对象，尽管是 void，但是当前 AVUser 实例对象里面的 sessionToken，objectId 都已更新
     * @memberOf RxAVUser
     */
    RxAVUser.prototype.signUp = function () {
        var _this = this;
        return RxAVUser.UserController.signUp(this.state, this.estimatedData).map(function (userState) {
            _this.handlerSignUp(userState);
            return true;
        });
    };
    /**
     * 发送注册用户时需要的验证码
     *
     * @static
     * @param {string} mobilephone 手机号
     * @returns {Observable&lt;boolean>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.sendSignUpShortcode = function (mobilephone) {
        var data = {
            mobilePhoneNumber: mobilephone
        };
        return RxLeanCloud_1.RxAVClient.request('/requestSmsCode', 'POST', data).map(function (body) {
            return true;
        });
    };
    /**
     * 发送登录时需要的验证码
     *
     * @static
     * @param {string} mobilephone 手机号
     * @returns {Observable&lt;boolean>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.sendLogInShortcode = function (mobilephone) {
        var data = {
            mobilePhoneNumber: mobilephone
        };
        return RxLeanCloud_1.RxAVClient.request('/requestLoginSmsCode', 'POST', data).map(function (body) {
            return true;
        });
    };
    /**
     * 使用手机号以及验证码创建新用户
     * @static
     * @param {string} mobilephone 手机号，目前支持几乎所有主流国家
     * @param {string} shortCode 6位数的数字组成的字符串
     * @returns {Observable&lt;RxAVUser>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.signUpByMobilephone = function (mobilephone, shortCode, newUser) {
        var encoded = SDKPlugins_1.SDKPlugins.instance.Encoder.encode(newUser.estimatedData);
        encoded['mobilePhoneNumber'] = mobilephone;
        encoded['smsCode'] = shortCode;
        return RxAVUser.UserController.logInWithParamters('/usersByMobilePhone', encoded).flatMap(function (userState) {
            var user = RxAVUser.createWithoutData();
            if (userState.isNew)
                return user.handlerSignUp(userState).map(function (s) {
                    return user;
                });
            else {
                return RxAVUser.processLogIn(userState);
            }
        });
    };
    /**
     * 使用手机号以及验证码登录
     *
     * @static
     * @param {string} mobilephone
     * @param {string} shortCode
     * @returns {Observable&lt;RxAVUser>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.logInByMobilephone = function (mobilephone, shortCode) {
        var data = {
            "mobilePhoneNumber": mobilephone,
            "smsCode": shortCode
        };
        return RxAVUser.UserController.logInWithParamters('/usersByMobilePhone', data).flatMap(function (userState) {
            var user = RxAVUser.createWithoutData();
            if (userState.isNew)
                return user.handlerSignUp(userState).map(function (s) {
                    return user;
                });
            else {
                return RxAVUser.processLogIn(userState);
            }
        });
    };
    /**
     * 使用用户名和密码登录
     *
     * @static
     * @param {string} username 用户名
     * @param {string} password 密码
     * @returns {Observable&lt;RxAVUser>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.logIn = function (username, password) {
        return RxAVUser.UserController.logIn(username, password).flatMap(function (userState) {
            return RxAVUser.processLogIn(userState);
        });
    };
    /**
     * 登出系统，删除本地缓存
     *
     * @returns {Observable&lt;boolean>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.prototype.logOut = function () {
        return RxAVUser.saveCurrentUser(null);
    };
    /**
     *  使用手机号+密码登录
     *
     * @static
     * @param {string} mobilephone 手机号
     * @param {string} password 密码
     * @returns {Observable&lt;RxAVUser>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.logInWithMobilephone = function (mobilephone, password) {
        var data = {
            "mobilePhoneNumber": mobilephone,
            "password": password
        };
        return RxAVUser.UserController.logInWithParamters('/login', data).flatMap(function (userState) {
            return RxAVUser.processLogIn(userState);
        });
    };
    /**
     * 创建一个用户，区别于 signUp，调用 create 方法并不会覆盖本地的 currentUser.
     *
     * @param {RxAVUser} user
     * @returns {Observable&lt;boolean>}
     *
     * @memberOf RxAVUser
     */
    RxAVUser.prototype.create = function () {
        var _this = this;
        return RxAVUser.UserController.signUp(this.state, this.estimatedData).map(function (userState) {
            _super.prototype.handlerSave.call(_this, userState);
            _this.state.serverData = userState.serverData;
            return true;
        });
    };
    // /**
    //  * 
    //  * 
    //  * @param {{ [key: string]: any }} authData 
    //  * 
    //  * @memberOf RxAVUser
    //  */
    // public logInWithOAuth2Data(authData: { [key: string]: any }) {
    // }
    RxAVUser.createWithoutData = function (objectId) {
        return RxLeanCloud_1.RxAVObject.createSubclass(RxAVUser, objectId);
    };
    RxAVUser.processLogIn = function (userState) {
        var user = RxAVUser.createWithoutData();
        return user.handlerLogIn(userState).map(function (s) {
            if (s)
                return user;
            else
                rxjs_1.Observable.from([null]);
        });
    };
    RxAVUser.prototype.handlerLogIn = function (userState) {
        this.handleFetchResult(userState);
        return RxAVUser.saveCurrentUser(this);
    };
    RxAVUser.prototype.handlerSignUp = function (userState) {
        _super.prototype.handlerSave.call(this, userState);
        this.state.serverData = userState.serverData;
        return RxAVUser.saveCurrentUser(this);
    };
    RxAVUser.installationKey = 'installations';
    RxAVUser.currenUserCacheKey = 'CurrentUser';
    RxAVUser._currentUser = null;
    return RxAVUser;
}(RxLeanCloud_1.RxAVObject));
exports.RxAVUser = RxAVUser;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Mar 01 2017 16:30:53 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
